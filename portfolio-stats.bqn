âŸ¨FromTSâ‡FromTimestamp, ToTSâ‡ToTimestampâŸ© â† â€¢Import "bqn-libs/datetime.bqn"
âŸ¨JParseâ‡ParseâŸ© â† â€¢Import "bqn-libs/json.bqn"
csvâ†â€¢Import "bqn-libs/csv.bqn"
strâ†â€¢Import "bqn-libs/strings.bqn"
ToUpper â† -âŸœ(32Ã—1="a{"âŠ¸â‹)
RowNu â† { ((â†•â‰ ğ•©)-ğ•¨) âˆ¾Ë˜ ğ•©}
SplitNum â†â€¢Parsefloatâ€¿âŠ¢{ğ• ğ•©}Â¨(("-."âˆ¾'0' + â†•10) (((âŠ¢â‹ˆÂ¬)âˆ˜âˆŠËœ)/Â¨(<âŠ¢)) âŠ¢)
NFmt â† âŸ¨"Â¯"âŸ©â€¿âŸ¨"-"âŸ©âŠ¸str.ReplaceAll âˆ˜ â€¢Fmt
ParseDT â† (âˆ¾âŸœ0â€¿0 4âŠ¸â†‘) (str.ToNums  âŸ¨"-"âŸ©â€¿âŸ¨" "âŸ©âŠ¸str.ReplaceAll) 
ParseTS â† FromTS ParseDT
IfElse â† {condâ€¿Trueâ€¿False: condâ—¶Falseâ€¿True @}


((â†•â‰ )â‰âŠ¢)âˆ˜âŠ‘ bghâ€¿bgd â† âŠ¢â€¿>{ğ•ğ•©}Â¨ 1(âŠ‘âˆ˜â†‘â‹ˆâ†“) csv.SplitL â€¢FLines "bags.csv"

â‰ 3â†‘ bgd
skip â† "USDT"â€¿"GBP"â€¿"BUSD"â€¿"DAI"â€¿"USD"
3â†‘ bagsâ† (â‹âŠË˜)âŠ¸âŠ (Â¬âˆ˜âŠË˜âˆŠâŸœskip)âŠ¸/ (âŠË˜âˆ¾Ë˜(â€¢ParseFloatÂ¨ 1âŠ¸â†“Ë˜)) âŸ¨"""","NaN"âŸ©â€¿âŸ¨"","0"âŸ©âŠ¸str.ReplaceAllÂ¨ bgd 
bagAssetsâ†âŠË˜bags

3â†‘â‰>cmcAssetsâ€¿cmcPriceUSDT â† <Ë˜âŠ¢â€¿â€¢ParseFloat {ğ•ğ•©}Â¨â‰(â‹âŠË˜)âŠ¸âŠ(Â¬âˆ˜âŠË˜âˆŠâŸœskip)âŠ¸/>1â€¿2âŠ¸âŠÂ¨ 1â†“ csv.SplitL â€¢Flines "cmc-quotes.csv"
# check all asset prices are downloaded
(Â¬bagAssets âˆŠ cmcAssets) / bagAssets
+Â´(Â¬bagAssets âˆŠ cmcAssets)

btcCmc â† (âŠ‘cmcAssets âŠ <"BTC") âŠ‘ cmcPriceUSDT
cmcPriceBTC â† cmcPriceUSDT Ã· btcCmc
ocmcPriceUSDTâ€¿ocmcPriceBTC â† (cmcAssets âŠ bagAssets)âŠ¸âŠÂ¨  cmcPriceUSDTâ€¿cmcPriceBTC
bgQtyâ€¿bgValUSDTâ€¿bgValBTC â†  1â€¿2â€¿5 âŠË˜Â¨ <bags
bgPriceUSDTâ€¿bgPriceBTC â†  bgValUSDTâ€¿bgValBTC Ã·Â¨ <bgQty
priceChUSDTâ€¿priceChBTC â† ocmcPriceUSDTâ€¿ocmcPriceBTC - bgPriceUSDTâ€¿bgPriceBTC
pctChUSDTâ€¿pctChBTC â† priceChUSDTâ€¿priceChBTC Ã· bgPriceUSDTâ€¿bgPriceBTC
vChUSDTâ€¿vChBTC â† priceChUSDTâ€¿priceChBTC Ã—Â¨ <bgQty
currValUSDTâ€¿currValBTC â† ocmcPriceUSDTâ€¿ocmcPriceBTC Ã—Â¨ <bgQty
3â†‘tblUSDT â† bgQTYâˆ¾Ë˜bgPriceUSDTâˆ¾Ë˜bgValUSDTâˆ¾Ë˜ocmcPriceUSDTâˆ¾Ë˜pctChUSDTâˆ¾Ë˜vChUSDTâˆ¾Ë˜currValUSDT
3â†‘tblBTCâ†bgQtyâˆ¾Ë˜bgPriceBTCâˆ¾Ë˜bgValBTCâˆ¾Ë˜ocmcPriceBTCâˆ¾Ë˜pctChBTCâˆ¾Ë˜vChBTCâˆ¾Ë˜currValBTC
poSkip â† "BNB"â€¿"USDC"
balThre â† 100<bgValUSDT
"portfolio-btc.csv" â€¢FLines (<"asset,bgQty,bgPrice,bgVal,ocmcPrice,pctChange,vChange,currVal") âˆ¾ csv.JoinL (balThre Ã— Â¬bagAssets âˆŠ poSkip)âŠ¸/ bagAssetsâˆ¾Ë˜ NFmtÂ¨ tblBTC
"portfolio-usdt.csv" â€¢FLines (<"asset,bgQty,bgPrice,bgVal,ocmcPrice,pctChange,vChange,currVal") âˆ¾ csv.JoinL (balThre Ã— Â¬bagAssets âˆŠ poSkip)âŠ¸/ bagAssetsâˆ¾Ë˜ NFmtÂ¨ tblUSDT

